WORK IN PROGRESS DO NOT USE YET PLEASE

This should work now, but hasn't been fully tested or documented.
